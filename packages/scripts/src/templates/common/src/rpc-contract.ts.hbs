import { oc } from "@orpc/contract";
import type { ContractRouterClient } from "@orpc/contract";
import type { ProcedureMetadata } from "@checkmate/common";
import { z } from "zod";
import {
  {{pluginNamePascal}}ItemSchema,
  Create{{pluginNamePascal}}ItemSchema,
  Update{{pluginNamePascal}}ItemSchema,
} from "./schemas";
import { permissions } from "./permissions";

// Create base builder with ProcedureMetadata support
// See: https://docs.checkmate.dev/common-plugins#contract-based-auth-enforcement
const _base = oc.$meta<ProcedureMetadata>({});

export const {{pluginNameCamel}}Contract = {
  // List all items - requires authenticated user with read permission
  getItems: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Read.id] })
    .output(z.array({{pluginNamePascal}}ItemSchema)),

  // Get single item
  getItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Read.id] })
    .input(z.string())
    .output({{pluginNamePascal}}ItemSchema),

  // Create item
  createItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Manage.id] })
    .input(Create{{pluginNamePascal}}ItemSchema)
    .output({{pluginNamePascal}}ItemSchema),

  // Update item
  updateItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Manage.id] })
    .input(
      z.object({
        id: z.string(),
        data: Update{{pluginNamePascal}}ItemSchema,
      })
    )
    .output({{pluginNamePascal}}ItemSchema),

  // Delete item
  deleteItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Manage.id] })
    .input(z.string())
    .output(z.void()),
};

// Export contract type for frontend
export type {{pluginNamePascal}}Contract = typeof {{pluginNameCamel}}Contract;

// Export typed client for backend-to-backend communication
export type {{pluginNamePascal}}Client = ContractRouterClient<typeof {{pluginNameCamel}}Contract>;
