import { oc } from "@orpc/contract";
import { createClientDefinition, type ProcedureMetadata } from "@checkstack/common";
import { z } from "zod";
import {
  {{pluginNamePascal}}ItemSchema,
  Create{{pluginNamePascal}}ItemSchema,
  Update{{pluginNamePascal}}ItemSchema,
} from "./schemas";
import { {{pluginNameCamel}}Access } from "./access";
import { pluginMetadata } from "./plugin-metadata";

// Create base builder with ProcedureMetadata support
// See: https://docs.checkstack.dev/common-plugins#contract-based-auth-enforcement
const _base = oc.$meta<ProcedureMetadata>({});

export const {{pluginNameCamel}}Contract = {
  // List all items - requires authenticated user with read access
  getItems: _base
    .meta({ operationType: "query", userType: "user", access: [{{pluginNameCamel}}Access.read] })
    .output(z.array({{pluginNamePascal}}ItemSchema)),

  // Get single item
  getItem: _base
    .meta({ operationType: "query", userType: "user", access: [{{pluginNameCamel}}Access.read] })
    .input(z.object({ id: z.string() }))
    .output({{pluginNamePascal}}ItemSchema),

  // Create item
  createItem: _base
    .meta({ operationType: "mutation", userType: "user", access: [{{pluginNameCamel}}Access.manage] })
    .input(Create{{pluginNamePascal}}ItemSchema)
    .output({{pluginNamePascal}}ItemSchema),

  // Update item
  updateItem: _base
    .meta({ operationType: "mutation", userType: "user", access: [{{pluginNameCamel}}Access.manage] })
    .input(
      z.object({
        id: z.string(),
        data: Update{{pluginNamePascal}}ItemSchema,
      })
    )
    .output({{pluginNamePascal}}ItemSchema),

  // Delete item
  deleteItem: _base
    .meta({ operationType: "mutation", userType: "user", access: [{{pluginNameCamel}}Access.manage] })
    .input(z.object({ id: z.string() }))
    .output(z.void()),
};

// Export contract type
export type {{pluginNamePascal}}Contract = typeof {{pluginNameCamel}}Contract;

// Export client definition for type-safe usePluginClient usage
// Frontend: const client = usePluginClient({{pluginNamePascal}}Api);
// Backend:  const client = rpcClient.forPlugin({{pluginNamePascal}}Api);
export const {{pluginNamePascal}}Api = createClientDefinition(
  {{pluginNameCamel}}Contract,
  pluginMetadata
);
