import { oc } from "@orpc/contract";
import { createClientDefinition, type ProcedureMetadata } from "@checkmate-monitor/common";
import { z } from "zod";
import {
  {{pluginNamePascal}}ItemSchema,
  Create{{pluginNamePascal}}ItemSchema,
  Update{{pluginNamePascal}}ItemSchema,
} from "./schemas";
import { permissions } from "./permissions";
import { pluginMetadata } from "./plugin-metadata";

// Create base builder with ProcedureMetadata support
// See: https://docs.checkmate-monitor.com/common-plugins#contract-based-auth-enforcement
const _base = oc.$meta<ProcedureMetadata>({});

export const {{pluginNameCamel}}Contract = {
  // List all items - requires authenticated user with read permission
  getItems: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Read.id] })
    .output(z.array({{pluginNamePascal}}ItemSchema)),

  // Get single item
  getItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Read.id] })
    .input(z.string())
    .output({{pluginNamePascal}}ItemSchema),

  // Create item
  createItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Manage.id] })
    .input(Create{{pluginNamePascal}}ItemSchema)
    .output({{pluginNamePascal}}ItemSchema),

  // Update item
  updateItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Manage.id] })
    .input(
      z.object({
        id: z.string(),
        data: Update{{pluginNamePascal}}ItemSchema,
      })
    )
    .output({{pluginNamePascal}}ItemSchema),

  // Delete item
  deleteItem: _base
    .meta({ userType: "user", permissions: [permissions.{{pluginNameCamel}}Manage.id] })
    .input(z.string())
    .output(z.void()),
};

// Export contract type
export type {{pluginNamePascal}}Contract = typeof {{pluginNameCamel}}Contract;

// Export client definition for type-safe forPlugin usage
// Use: const client = rpcApi.forPlugin({{pluginNamePascal}}Api);
export const {{pluginNamePascal}}Api = createClientDefinition(
  {{pluginNameCamel}}Contract,
  pluginMetadata
);
